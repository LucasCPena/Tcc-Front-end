<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main-Page</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.6/dist/flatpickr.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.6/dist/flatpickr.min.js"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pt.js"></script>
    <link rel="stylesheet" href="appointment.css" />
  </head>

  <body>
    <header>
      <nav>
        <h2 class="logo">CoWorking</h2>

        <ul class="nav-list">
          <li><a href="main.html">Inicio</a></li>
          <li><a href="about.html">Sobre</a></li>
          <li class="dropdown">
            <a href="#">Reservas</a>
            <ul class="dropdown-content">
              <li><a href="booking.html">Minhas Reservas</a></li>
            </ul>
          </li>
          <li><a href="contato.html">Contato</a></li>
        </ul>
      </nav>
    </header>

    <div class="container">
      <div class="card">
        <div class="info">
          <img src="Images/2815428.png" width="150px" alt="person" />
          <h6>Fulano de tal Souza</h6>
          <span>Analista de Suporte</span>
        </div>
        <button class="mreserva">
          <a href="booking.html">Minhas Reservas</a>
        </button>
      </div>

      <div class="dash">
        <h1>Nova Reserva</h1>
        <div class="search-container">
          <input type="text" id="date" placeholder="Selecione uma data" />
          <button onclick="createAppointment()">Adicionar Reserva</button>
        </div>
        <h2>Suas Reservas</h2>
        <ul id="reservation-list"></ul>
      </div>
    </div>

    <script>
      const token = localStorage.getItem("token");

      if (!token) {
        window.location.replace("http://localhost:5000/login");
      }

      flatpickr("#date", {
        dateFormat: "Y-m-d",
        minDate: "today",
        locale: "pt",
      });

      const dateElement = document.getElementById("date");

      async function createAppointment() {
        const date = dateElement.value;

        const result = await fetch("http://localhost:3000/appointment", {
          method: "POST",
          body: JSON.stringify({ date }),
          headers: {
            Accept: "application/json, text/plain, */*",
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
        });

        if (result.status === 200) {
          alert("Apontamento criado com sucesso");
          window.location.replace("http://localhost:5000/booking.html");
        }
      }
    </script>
  </body>
</html>
